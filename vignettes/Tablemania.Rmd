---
title: "Table mania"
author: "Max Gordon"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
    toc: true
vignette: >
  %\VignetteIndexEntry{Table mania}
  %\VignetteEngine{knitr::rmarkdown}
  %\usepackage[utf8]{inputenc}
---

Introduction
============

Tables are an essential part of publishing, well... anything. I therefore want to explore the options available for generating these in markdown. It is important to remember that there are two ways principal ways of generating tables in markdown:

1. Markdown adapted table
2. HTML tables

Mardkown tables
===============

Raw tables
----------

A markdown table is fairly straight forward and are simple to manually create. Just write the plain text below:

<pre>
1st Header  | 2nd Header
----------- | -------------
Content A   | Content B
Content C   | Content D
</pre>

And you will end up with this beauty:

1st Header  | 2nd Header
----------- | -------------
Content A   | Content B
Content C   | Content D

The `knitr::kable` function
---------------------------

Now this is not the R way, we want to use a function that does this. The **knitr** comes with a table function well suited for this, **kable**:

```{r, results='asis'}
# First generate the corresponding
# matrix to the above example
output <- 
  matrix(sprintf("Content %s", LETTERS[1:4]),
         ncol=2, byrow=TRUE)
colnames(output) <- 
  c("1st header", "2nd header")
rownames(output) <- 
  c("1st row", "2nd row")

library(knitr)
kable(output, 
      caption="A test table", 
      align = c("c", "r"))
```

The advantage with the `kable` function is that it outputs true markdown tables and these can through the [pandoc](http://johnmacfarlane.net/pandoc/README.html#tables) system be converted to any document format. Some of the downsides are:

* Lack of adding row groups and column groups
* No control over cell formatting
* No control over borders
* ...

HTML tables
===========

Tables are possibly the most tested HTML-element out there. In early web design this was the only feature that browsers handled uniformly, and became therefore for a long period the standard way of doing layout. They are thereby an excellent template for generating advanced tables in statistics. There are currently three different implementations that I've encountered, the **xtable**, the **format.tables**, and my own **htmlTable** function. The `format.tables` is unfortunately not yet on CRAN and will not be part of this vignette due to CRAN rules. If you are interested you can find it [here](https://github.com/SwedishPensionsAgency/format.tables).

The `xtable`-package
--------------------

The `xtable` is a solution that delivers both html and LaTeX. The syntaxt is very similar to `kable`:

```{r, results='asis'}
library(xtable)
print(xtable(output, 
             caption="A test table", 
             align = c("l", "c", "r")), 
      type="html")
```

The downside with the function is that you need to change output depending on your target and there is not that much advantage compared to `kable`.

The `htmlTable` in the `Gmisc`-package
--------------------------------------

I developed the `htmlTable` inorder to get tables matching those available in top medical journals. After finding no html-alternative to the `Hmisc::latex` function on [Stack Overflow](http://stackoverflow.com/questions/11950703/html-with-multicolumn-table-in-markdown-using-knitr) I wrote a basic function allowing column spanners and row groups. Below is a basic example on these two:

```{r, results='asis'}
output <- 
  matrix(paste("Content", LETTERS[1:16]), 
         ncol=4, byrow = TRUE)

library(Gmisc)
htmlTable(output,
          rgroup = c("Group A-H",
                     "Group I-P"),
          n.rgroup = c(2,2),
          rnames = paste(c("1st", "2nd",
                           "3rd", "4th"), "row"),
          cgroup = c("Cgroup 1", "Cgroup 2&dagger;"),
          n.cgroup = c(2,2), 
          caption="Basic table with both column spanners (groups) and row groups",
          tfoot="&dagger; A table footer commment")
```

```{r, results='asis'}
data(SCB)
rownames(SCB) <- SCB$year
SCB$year <- NULL

cgroup <- c("Men", "Women")
n.cgroup <- 
  sapply(tolower(cgroup),
         function(x) sum(grepl(sprintf("^%s_", x),
                               names(SCB))))
names(SCB) <- 
  gsub("^(men|women)_", "", names(SCB))

names(SCB) <- 
  gsub("[ ]county$", "", names(SCB))

# The problem with round is that 39.0 becomes
# 39 in the table, we want to keep the change
mx <- NULL
for (n in names(SCB)){
  mx <- cbind(mx,
              cbind(SCB[[n]], 
                    SCB[[n]] - SCB[[n]][1]))
}
mx <- t(apply(mx, 1, function(x) sprintf("%.1f", x)))
rownames(mx) <- rownames(SCB)
colnames(mx) <- rep(c("Age", "&Delta;"), times = ncol(SCB))
cgroup <- rbind(c(cgroup, rep(NA, ncol(SCB) - 2)),
                names(SCB))
n.cgroup <- rbind(c(n.cgroup*2, rep(NA, ncol(SCB) - 2)),
                  rep(2, length(n.cgroup)))

htmlTable(mx, 
          col.columns = c("#EEEEEE", "#EEEEEE", "white", "white"),
          cgroup = cgroup,
          n.cgroup = n.cgroup,
          rgroup = c("00:s", "10:s"),
          n.rgroup = c(grep("2009", rownames(mx)),
                        nrow(mx) - grep("2009", rownames(mx))),
          cspan.rgroup = 1)
```

More *raw* markdown tables
========================

There are a few more text alternatives available when desiging tables. I included these from the manual for completeness.

<pre>
| Right | Left | Default | Center |
|------:|:-----|---------|:------:|
|   12  |  12  |    12   |    12  |
|  123  |  123 |   123   |   123  |
|    1  |    1 |     1   |     1  |

: Demonstration of pipe table syntax.
</pre>

| Right | Left | Default | Center |
|------:|:-----|---------|:------:|
|   12  |  12  |    12   |    12  |
|  123  |  123 |   123   |   123  |
|    1  |    1 |     1   |     1  |

  : Demonstration of pipe table syntax.

<pre>
: Sample grid table.

+---------------+---------------+--------------------+
| Fruit         | Price         | Advantages         |
+===============+===============+====================+
| Bananas       | $1.34         | - built-in wrapper |
|               |               | - bright color     |
+---------------+---------------+--------------------+
| Oranges       | $2.10         | - cures scurvy     |
|               |               | - tasty            |
+---------------+---------------+--------------------+
</pre>

: Sample grid table.

+---------------+---------------+--------------------+
| Fruit         | Price         | Advantages         |
+===============+===============+====================+
| Bananas       | $1.34         | - built-in wrapper |
|               |               | - bright color     |
+---------------+---------------+--------------------+
| Oranges       | $2.10         | - cures scurvy     |
|               |               | - tasty            |
+---------------+---------------+--------------------+